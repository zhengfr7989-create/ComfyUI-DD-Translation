<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ComfyUI 翻译 JSON 生成器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            margin: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 20%, transparent 50%);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translate(-50%, -50%) rotate(0deg); }
            50% { transform: translate(-50%, -50%) rotate(180deg); }
        }

        .header h1 {
            font-size: 2.8em;
            margin-bottom: 15px;
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
            position: relative;
            z-index: 1;
        }

        .main-content {
            padding: 50px;
        }

        .type-selector {
            margin-bottom: 50px;
        }

        .type-selector h2 {
            color: #2d3748;
            margin-bottom: 25px;
            font-size: 1.8em;
            font-weight: 600;
            text-align: center;
        }

        .type-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        .type-btn {
            padding: 25px 35px;
            border: 3px solid transparent;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-size: 1.2em;
            font-weight: 600;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .type-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }

        .type-btn:hover::before {
            left: 100%;
        }

        .type-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .type-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .config-section {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .config-section.active {
            display: block;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .node-name-input {
            margin-bottom: 30px;
        }

        .node-name-input label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
        }

        .node-name-input input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1.1em;
            transition: border-color 0.3s ease;
        }        .node-name-input input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .node-title-input {
            margin-bottom: 30px;
        }

        .node-title-input label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
        }

        .node-title-input input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1.1em;
            transition: border-color 0.3s ease;
        }

        .node-title-input input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .node-description-input {
            margin-bottom: 30px;
        }

        .node-description-input label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
        }

        .node-description-input input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1.1em;
            transition: border-color 0.3s ease;
        }

        .node-description-input input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }        .nodes-management {
            margin-bottom: 40px;
        }

        .node-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
        }

        .node-tab {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            border: 2px solid #e2e8f0;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 1em;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            position: relative;
            overflow: hidden;
            gap: 8px;
        }

        .node-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            transition: left 0.5s;
        }

        .node-tab:hover::before {
            left: 100%;
        }

        .node-tab:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.15);
        }

        .node-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.3);
        }

        .node-tab.active .tab-close {
            color: rgba(255,255,255,0.8);
        }

        .node-tab.active .tab-close:hover {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .tab-close {
            background: none;
            border: none;
            color: #64748b;
            margin-left: auto;
            font-size: 16px;
            cursor: pointer;
            padding: 4px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .tab-close:hover {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        /* 为第一个节点（无删除按钮）优化样式 */
        .node-tab[data-node="0"] {
            padding: 12px 24px;
        }

        .node-tab[data-node="0"] span {
            margin: 0;
        }

        .btn {
            padding: 12px 18px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .btn-add {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3em;
            border-radius: 50%;
        }

        .btn-remove {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 1.1em;
        }

        .btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .btn-add:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
        }

        .btn-remove:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        }

        .add-section {
            text-align: center;
            margin-top: 20px;
        }

        .empty-state {
            text-align: center;
            color: #6b7280;
            font-style: italic;
            padding: 30px;
            background: rgba(255,255,255,0.5);
            border-radius: 10px;
            border: 2px dashed #d1d5db;
            margin: 15px 0;
        }

        .generate-section {
            text-align: center;
            margin-top: 50px;
            padding: 50px 40px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 24px;
            border: 1px solid rgba(102, 126, 234, 0.1);
            box-shadow: 0 10px 40px rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }

        .generate-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2, #10b981);
            opacity: 0.8;
        }

        .filename-input {
            margin-bottom: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            background: white;
            padding: 25px 35px;
            border-radius: 18px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border: 2px solid #f1f5f9;
            transition: all 0.3s ease;
            max-width: 600px;
            margin: 0 auto 35px auto;
        }

        .filename-input:hover {
            border-color: #e0e7ff;
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.1);
        }

        .filename-input label {
            font-weight: 700;
            color: #1e293b;
            font-size: 1.2em;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filename-input input {
            flex: 1;
            min-width: 200px;
            padding: 18px 22px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            background: linear-gradient(135deg, #fafbfc 0%, #f8fafc 100%);
            text-align: center;
        }

        .filename-input input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            background: white;
            transform: scale(1.02);
        }

        .filename-input span {
            font-weight: 600;
            color: #64748b;
            font-size: 1.1em;
            white-space: nowrap;
        }

        @media (max-width: 768px) {
            .filename-input {
                flex-direction: column;
                text-align: center;
                padding: 20px 25px;
            }
            
            .filename-input input {
                min-width: auto;
                width: 100%;
                text-align: center;
            }
        }

        .node-basic-info {
            background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(79, 172, 254, 0.2);
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.1);
        }        .node-name-input, .node-description-input, .node-title-input {
            margin-bottom: 25px;
        }

        .node-name-input label, .node-description-input label, .node-title-input label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            color: #1a202c;
            font-size: 1.1em;
        }

        .node-name-input input, .node-description-input input, .node-title-input input {
            width: 100%;
            padding: 18px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1.1em;
            transition: all 0.3s ease;
            background: white;
        }

        .node-name-input input:focus, .node-description-input input:focus, .node-title-input input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }.node-sections {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        @media (min-width: 1400px) {
            .node-sections {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 30px;
            }
            
            .key-value-section:last-child {
                grid-column: 1 / -1;
            }
        }

        .key-value-section {
            background: white;
            border-radius: 20px;
            padding: 35px;
            margin-bottom: 0;
            min-height: auto;
            border: 2px solid #f1f5f9;
            box-shadow: 0 4px 20px rgba(0,0,0,0.03);
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            overflow: hidden;
        }

        .key-value-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }

        .key-value-section:hover::before {
            transform: scaleX(1);
        }

        .key-value-section:hover {
            box-shadow: 0 12px 40px rgba(102, 126, 234, 0.15);
            transform: translateY(-4px);
            border-color: #e0e7ff;
        }

        .section-title {
            color: #1e293b;
            margin-bottom: 30px;
            font-size: 1.3em;
            font-weight: 700;
            padding-left: 0;
            border-left: none;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-title::before {
            content: '';
            width: 6px;
            height: 6px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            flex-shrink: 0;
        }

        .section-title::after {
            display: none;
        }

        .key-value-pair {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 16px;
            margin-bottom: 16px;
            align-items: center;
            padding: 0;
            background: transparent;
            border-radius: 0;
            box-shadow: none;
            transition: none;
        }

        .key-value-pair:hover {
            box-shadow: none;
            transform: none;
        }

        .key-value-pair input {
            flex: none;
            min-width: 0;
            padding: 16px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1em;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            background: #fafbfc;
            font-weight: 500;
        }

        .key-value-pair input:first-child {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-color: #cbd5e1;
        }

        .key-value-pair input:nth-child(2) {
            background: linear-gradient(135deg, #fefce8 0%, #fef3c7 100%);
            border-color: #d4d4aa;
        }

        .key-value-pair input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            background: white;
            transform: translateY(-1px);
        }

        .key-value-pair input::placeholder {
            color: #94a3b8;
            font-weight: 400;
        }

        .btn-remove {
            background: #f1f5f9;
            color: #64748b;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            font-size: 16px;
            border: 2px solid #e2e8f0;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .btn-remove:hover {
            background: #fee2e2;
            color: #dc2626;
            border-color: #fecaca;
            transform: scale(1.1);
        }

        .btn-add {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            border-radius: 16px;
            border: none;
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.25);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .btn-add:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.35);
        }

        .btn-add:active {
            transform: translateY(0) scale(0.95);
        }

        .empty-state {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }

        .filename-input {
            margin-bottom: 20px;
        }

        .filename-input input {
            width: 300px;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            margin-left: 10px;
        }

        .preview-content {
            background: #1a202c;
            color: #e2e8f0;
            border-radius: 12px;
            padding: 25px;
            font-family: 'JetBrains Mono', 'Fira Code', 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 500px;
            overflow-y: auto;
            line-height: 1.6;
            border: 1px solid #374151;
        }

        /* 预览区域样式 */
        .preview-section {
            margin-top: 40px;
            display: none;
            background: white;
            border-radius: 20px;
            padding: 35px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
            border: 2px solid #f1f5f9;
            animation: slideIn 0.5s ease-out;
        }

        .preview-section.show {
            display: block;
        }

        .preview-title {
            color: #1e293b;
            margin-bottom: 25px;
            font-size: 1.4em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .preview-title::before {
            content: '';
            width: 8px;
            height: 8px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            flex-shrink: 0;
        }

        /* === 按钮层级设计系统 === */
        
        /* 主要操作按钮 - 最高优先级 */
        .btn-generate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 18px 40px;
            font-size: 1.2em;
            font-weight: 700;
            border-radius: 16px;
            border: none;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            overflow: hidden;
            text-transform: none;
            letter-spacing: 0.5px;
            margin: 0 12px 15px 0;
            min-width: 180px;
        }

        .btn-generate::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.6s ease;
        }

        .btn-generate:hover::before {
            left: 100%;
        }

        .btn-generate:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
        }

        .btn-generate:active {
            transform: translateY(-1px) scale(0.98);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        /* 次要积极操作按钮 */
        .btn-contribute {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 16px 32px;
            font-size: 1.1em;
            font-weight: 600;
            border-radius: 14px;
            border: none;
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.25);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            margin: 0 12px 15px 0;
            min-width: 160px;
            position: relative;
            overflow: hidden;
        }

        .btn-contribute::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn-contribute:hover::before {
            left: 100%;
        }

        .btn-contribute:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 30px rgba(16, 185, 129, 0.35);
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
        }

        .btn-contribute:active {
            transform: translateY(-1px) scale(0.98);
        }

        /* 危险操作按钮 */
        .btn-clear {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            color: #64748b;
            padding: 14px 28px;
            font-size: 1em;
            font-weight: 500;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            margin: 0 12px 15px 0;
            min-width: 140px;
            cursor: pointer;
        }

        .btn-clear:hover {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #dc2626;
            border-color: #fca5a5;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(220, 38, 38, 0.15);
        }

        .btn-clear:active {
            transform: translateY(0) scale(0.95);
        }

        /* 按钮容器布局优化 */
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 0;
            margin-top: 35px;
            padding-top: 25px;
            border-top: 2px solid #f1f5f9;
        }

        /* 响应式适配 */
        @media (max-width: 768px) {
            .action-buttons {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }
            
            .btn-generate, .btn-contribute, .btn-clear {
                margin: 0;
                width: 100%;
                min-width: auto;
                justify-content: center;
                display: flex;
                align-items: center;
            }
            
            .btn-generate {
                padding: 20px 32px;
                font-size: 1.3em;
            }
            
            .btn-contribute {
                padding: 18px 28px;
                font-size: 1.15em;
            }
            
            .btn-clear {
                padding: 16px 24px;
                font-size: 1.05em;
            }
        }

        /* 按钮加载状态 */
        .btn-loading {
            pointer-events: none;
            position: relative;
            color: transparent !important;
        }

        .btn-loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top: 2px solid rgba(255,255,255,0.8);
            border-radius: 50%;
            animation: btnSpin 0.8s linear infinite;
        }

        @keyframes btnSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 禁用状态 */
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .btn:disabled:hover {
            transform: none !important;
            box-shadow: none !important;
        }

        .contribute-info {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border: 2px solid #10b981;
            border-radius: 16px;
            padding: 35px;
            margin-top: 30px;
            display: none;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.1);
            text-align: center;
        }

        .contribute-info.show {
            display: block;
            animation: slideIn 0.5s ease-out;
        }

        .contribute-info h4 {
            color: #064e3b;
            margin-bottom: 20px;
            font-size: 1.4em;
            font-weight: 700;
        }

        .contribute-info p {
            color: #065f46;
            margin-bottom: 30px;
            line-height: 1.6;
            font-size: 1.1em;
        }

        .contribute-actions {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 400px;
            margin: 0 auto;
        }

        .contribute-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 18px 32px;
            border-radius: 14px;
            font-size: 1.1em;
            font-weight: 600;
            text-decoration: none;
            border: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            overflow: hidden;
            gap: 10px;
        }

        .contribute-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .contribute-btn:hover::before {
            left: 100%;
        }

        .contribute-btn-primary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.25);
        }

        .contribute-btn-primary:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 30px rgba(16, 185, 129, 0.35);
            color: white;
        }

        .contribute-btn-secondary {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            color: #374151;
            border: 2px solid #10b981;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .contribute-btn-secondary:hover {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        }

        @media (min-width: 600px) {
            .contribute-actions {
                flex-direction: row;
                max-width: 500px;
            }
        }

        /* 导入功能区域样式 */
        .import-section {
            margin-bottom: 50px;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-radius: 20px;
            padding: 40px;
            border: 2px solid rgba(14, 165, 233, 0.2);
            box-shadow: 0 10px 30px rgba(14, 165, 233, 0.1);
            position: relative;
            overflow: hidden;
        }

        .import-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #0ea5e9, #3b82f6, #6366f1);
            opacity: 0.8;
        }

        .import-section h2 {
            color: #1e40af;
            margin-bottom: 25px;
            font-size: 1.8em;
            font-weight: 700;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .import-area {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid rgba(14, 165, 233, 0.15);
        }

        .import-description {
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-radius: 12px;
            border-left: 4px solid #3b82f6;
        }

        .import-description p {
            margin: 0 0 8px 0;
            color: #1e40af;
            line-height: 1.6;
        }

        .import-description p:last-child {
            margin-bottom: 0;
            color: #374151;
        }

        .import-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .btn-import {
            background: linear-gradient(135deg, #0ea5e9 0%, #3b82f6 100%);
            color: white;
            padding: 14px 28px;
            font-size: 1em;
            font-weight: 600;
            border-radius: 12px;
            border: none;
            box-shadow: 0 4px 15px rgba(14, 165, 233, 0.25);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .btn-import::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn-import:hover::before {
            left: 100%;
        }

        .btn-import:hover {
            background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 25px rgba(14, 165, 233, 0.35);
        }

        .btn-import-process {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 14px 28px;
            font-size: 1em;
            font-weight: 600;
            border-radius: 12px;
            border: none;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.25);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .btn-import-process:disabled {
            background: linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%);
            color: #9ca3af;
            cursor: not-allowed;
            box-shadow: none;
            transform: none !important;
        }

        .btn-import-process:not(:disabled)::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn-import-process:not(:disabled):hover::before {
            left: 100%;
        }

        .btn-import-process:not(:disabled):hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.35);
        }

        .file-info {
            color: #64748b;
            font-size: 0.95em;
            font-weight: 500;
            padding: 8px 16px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }

        .file-info.selected {
            color: #059669;
            background: #ecfdf5;
            border-color: #a7f3d0;
        }

        .import-preview {
            background: #1a202c;
            color: #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #374151;
        }

        .import-preview h4 {
            color: #3b82f6;
            margin-bottom: 15px;
            font-size: 1.1em;
            font-weight: 600;
        }

        .import-preview-content {
            font-family: 'JetBrains Mono', 'Fira Code', 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            line-height: 1.5;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .import-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .btn-import, .btn-import-process {
                width: 100%;
                justify-content: center;
            }
            
            .file-info {
                max-width: none;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎨 ComfyUI 翻译生成器</h1>
            <p>轻松创建 ComfyUI 节点、分类和设置的中文翻译文件</p>
        </div>
        
        <div class="main-content">
            <!-- 类型选择 -->
            <div class="type-selector">
                <h2>📋 选择翻译类型</h2>
                <div class="type-buttons">
                    <button class="type-btn" data-type="categories">📁 分类翻译</button>
                    <button class="type-btn" data-type="nodes">🔧 节点翻译</button>
                    <button class="type-btn" data-type="menus">⚙️ 设置菜单</button>
                </div>
            </div>

            <!-- JSON文件导入功能区域 -->
            <div class="import-section">
                <h2>📥 导入现有翻译文件</h2>
                <div class="import-area">
                    <div class="import-description">
                        <p>💡 <strong>快速更新现有翻译：</strong></p>
                        <p>选择已有的翻译JSON文件进行导入，在此基础上添加新的节点或修改现有翻译。</p>
                    </div>
                    <div class="import-controls">
                        <input type="file" id="json-file-input" accept=".json" style="display: none;">
                        <button class="btn btn-import" onclick="triggerFileInput()">
                            📁 选择JSON文件
                        </button>
                        <span class="file-info" id="file-info">未选择文件</span>
                        <button class="btn btn-import-process" onclick="processImportedFile()" disabled>
                            🚀 导入并编辑
                        </button>
                    </div>
                    <div class="import-preview" id="import-preview" style="display: none;">
                        <h4>📄 文件预览：</h4>
                        <div class="import-preview-content" id="import-preview-content"></div>
                    </div>
                </div>
            </div>

            <!-- 分类翻译配置 -->
            <div class="config-section" id="categories-config">
                <div class="section-title">📁 分类翻译配置</div>
                <div class="key-value-section">
                    <div id="categories-pairs">
                        <div class="empty-state">点击下方 + 按钮添加分类翻译项</div>
                    </div>
                    <div class="add-section">
                        <button class="btn btn-add" onclick="addCategoryPair()">+</button>
                    </div>
                </div>
            </div>            <!-- 节点翻译配置 -->
            <div class="config-section" id="nodes-config">
                <div class="nodes-management">
                    <div class="section-title">📦 多节点管理</div>                    <div class="node-tabs" id="node-tabs">
                        <button class="node-tab active" data-node="0" onclick="switchToNode(0)">
                            <span>节点 1</span>
                        </button>
                        <button class="btn btn-add-node" onclick="addNewNode()">+ 添加节点</button>
                    </div>
                </div>

                <!-- 节点容器 -->
                <div id="nodes-container">
                    <!-- 第一个节点 -->
                    <div class="single-node-config" id="node-config-0" style="display: block;">
                        <div class="node-basic-info">
                            <div class="node-name-input">
                                <label for="node-name-0">🎯 节点类名 (Class Name):</label>
                                <input type="text" id="node-name-0" placeholder="例如: KSampler" onchange="updateNodeTab(0)">
                            </div>
                            
                            <div class="node-title-input">
                                <label for="node-title-0">🏷️ 翻译后标题 (必填):</label>
                                <input type="text" id="node-title-0" placeholder="例如: K采样器" required>
                            </div>
                            
                            <div class="node-description-input">
                                <label for="node-desc-0">📝 节点功能描述 (可选):</label>
                                <input type="text" id="node-desc-0" placeholder="例如: 使用不同的采样器和调度器进行图像生成">
                            </div>
                        </div>

                        <div class="node-sections">
                            <!-- 输入项 -->
                            <div class="key-value-section">
                                <div class="section-title">📥 输入 (Inputs)</div>
                                <div id="inputs-pairs-0">
                                    <div class="empty-state">点击下方 + 按钮添加输入项</div>
                                </div>
                                <div class="add-section">
                                    <button class="btn btn-add" onclick="addInputPair(0)">+</button>
                                </div>
                            </div>

                            <!-- 控件项 -->
                            <div class="key-value-section">
                                <div class="section-title">🎛️ 控件 (Widgets)</div>
                                <div id="widgets-pairs-0">
                                    <div class="empty-state">点击下方 + 按钮添加控件项</div>
                                </div>
                                <div class="add-section">
                                    <button class="btn btn-add" onclick="addWidgetPair(0)">+</button>
                                </div>
                            </div>

                            <!-- 输出项 -->
                            <div class="key-value-section">
                                <div class="section-title">📤 输出 (Outputs)</div>
                                <div id="outputs-pairs-0">
                                    <div class="empty-state">点击下方 + 按钮添加输出项</div>
                                </div>
                                <div class="add-section">
                                    <button class="btn btn-add" onclick="addOutputPair(0)">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 设置菜单配置 -->
            <div class="config-section" id="menus-config">
                <div class="section-title">⚙️ 设置菜单配置</div>
                <div class="key-value-section">
                    <div id="menus-pairs">
                        <div class="empty-state">点击下方 + 按钮添加菜单翻译项</div>
                    </div>
                    <div class="add-section">
                        <button class="btn btn-add" onclick="addMenuPair()">+</button>
                    </div>
                </div>
            </div>            <!-- 生成按钮 -->
            <div class="generate-section">
                <div class="filename-input">
                    <label>📝 文件名: </label>
                    <input type="text" id="filename" placeholder="例如: ComfyUI-Manager">
                    <span>.json</span>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-generate" onclick="generateJSON()">
                        🚀 生成 JSON
                    </button>
                    <button class="btn btn-contribute" onclick="contributeTranslation()">
                        🤝 贡献翻译
                    </button>
                    <button class="btn btn-clear" onclick="clearAll()">
                        🗑️ 清空所有
                    </button>
                </div>
            </div>            <!-- 贡献选项 -->
            <div class="contribute-info" id="contribute-info">
                <h4>🎉 感谢您的贡献！</h4>
                <p>选择您希望的贡献方式：</p>
                
                <div class="contribute-actions">
                    <a href="https://github.com/Dontdrunk/ComfyUI-DD-Translation" target="_blank" 
                       class="contribute-btn contribute-btn-primary">
                        🔗 访问 GitHub 项目
                    </a>
                    <button onclick="createGitHubIssue()" class="contribute-btn contribute-btn-secondary">
                        📝 创建贡献 Issue
                    </button>
                </div>
            </div>

            <!-- 预览区域 -->
            <div class="preview-section" id="preview">
                <div class="preview-title">📄 JSON 预览</div>
                <div class="preview-content" id="preview-content"></div>
            </div>
        </div>
    </div>    <script>
        let currentType = '';
        let currentNodeIndex = 0;
        let nodeCount = 1;

        // 类型选择
        document.querySelectorAll('.type-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                // 移除所有活动状态
                document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.config-section').forEach(s => s.classList.remove('active'));
                
                // 设置当前活动状态
                btn.classList.add('active');
                currentType = btn.dataset.type;
                document.getElementById(currentType + '-config').classList.add('active');
                
                // 隐藏预览
                document.getElementById('preview').classList.remove('show');

                // 如果是节点类型，初始化节点区域
                if (currentType === 'nodes') {
                    initializeNodeSections();
                }
            });
        });

        // 初始化节点区域
        function initializeNodeSections() {
            const sectionsContainer = document.getElementById('node-sections-0');
            if (!sectionsContainer.innerHTML.trim()) {
                sectionsContainer.innerHTML = `
                    <!-- 输入项 -->
                    <div class="key-value-section">
                        <div class="section-title">📥 输入 (Inputs)</div>
                        <div id="inputs-pairs-0">
                            <div class="empty-state">点击下方 + 按钮添加输入项</div>
                        </div>
                        <div class="add-section">
                            <button class="btn btn-add" onclick="addInputPair(0)">+</button>
                        </div>
                    </div>

                    <!-- 控件项 -->
                    <div class="key-value-section">
                        <div class="section-title">🎛️ 控件 (Widgets)</div>
                        <div id="widgets-pairs-0">
                            <div class="empty-state">点击下方 + 按钮添加控件项</div>
                        </div>
                        <div class="add-section">
                            <button class="btn btn-add" onclick="addWidgetPair(0)">+</button>
                        </div>
                    </div>

                    <!-- 输出项 -->
                    <div class="key-value-section">
                        <div class="section-title">📤 输出 (Outputs)</div>
                        <div id="outputs-pairs-0">
                            <div class="empty-state">点击下方 + 按钮添加输出项</div>
                        </div>
                        <div class="add-section">
                            <button class="btn btn-add" onclick="addOutputPair(0)">+</button>
                        </div>
                    </div>
                `;
            }
        }        // 添加键值对的通用函数
        function createKeyValuePair(containerId, onRemove) {
            const pair = document.createElement('div');
            pair.className = 'key-value-pair';
            pair.innerHTML = `
                <input type="text" placeholder="英文原文">
                <input type="text" placeholder="中文翻译">
                <button class="btn btn-remove" onclick="${onRemove}(this)">×</button>
            `;
            return pair;
        }        // 添加新节点
        function addNewNode() {
            const nodeIndex = nodeCount;
            nodeCount++;

            // 添加节点标签
            const tabsContainer = document.querySelector('.node-tabs');
            const addButton = tabsContainer.querySelector('.btn-add-node');
            
            const newTab = document.createElement('button');
            newTab.className = 'node-tab';
            newTab.setAttribute('data-node', nodeIndex);
            newTab.onclick = () => switchToNode(nodeIndex);
            newTab.innerHTML = `
                <span>节点 ${nodeIndex + 1}</span>
                <button class="tab-close" onclick="removeNode(${nodeIndex}, event)">×</button>
            `;
            
            tabsContainer.insertBefore(newTab, addButton);

            // 创建新的节点配置
            const nodesContainer = document.getElementById('nodes-container');
            const newNodeConfig = document.createElement('div');
            newNodeConfig.className = 'single-node-config';
            newNodeConfig.id = `node-config-${nodeIndex}`;
            newNodeConfig.innerHTML = `
                <div class="node-basic-info">
                    <div class="node-name-input">
                        <label for="node-name-${nodeIndex}">🎯 节点类名 (Class Name):</label>
                        <input type="text" id="node-name-${nodeIndex}" placeholder="例如: KSampler" onchange="updateNodeTab(${nodeIndex})">
                    </div>
                    
                    <div class="node-title-input">
                        <label for="node-title-${nodeIndex}">🏷️ 翻译后标题 (必填):</label>
                        <input type="text" id="node-title-${nodeIndex}" placeholder="例如: K采样器" required>
                    </div>
                    
                    <div class="node-description-input">
                        <label for="node-desc-${nodeIndex}">📝 节点功能描述 (可选):</label>
                        <input type="text" id="node-desc-${nodeIndex}" placeholder="例如: 使用不同的采样器和调度器进行图像生成">
                    </div>
                </div>

                <div class="node-sections">
                    <!-- 输入项 -->
                    <div class="key-value-section">
                        <div class="section-title">📥 输入 (Inputs)</div>
                        <div id="inputs-pairs-${nodeIndex}">
                            <div class="empty-state">点击下方 + 按钮添加输入项</div>
                        </div>
                        <div class="add-section">
                            <button class="btn btn-add" onclick="addInputPair(${nodeIndex})">+</button>
                        </div>
                    </div>

                    <!-- 控件项 -->
                    <div class="key-value-section">
                        <div class="section-title">🎛️ 控件 (Widgets)</div>
                        <div id="widgets-pairs-${nodeIndex}">
                            <div class="empty-state">点击下方 + 按钮添加控件项</div>
                        </div>
                        <div class="add-section">
                            <button class="btn btn-add" onclick="addWidgetPair(${nodeIndex})">+</button>
                        </div>
                    </div>

                    <!-- 输出项 -->
                    <div class="key-value-section">
                        <div class="section-title">📤 输出 (Outputs)</div>
                        <div id="outputs-pairs-${nodeIndex}">
                            <div class="empty-state">点击下方 + 按钮添加输出项</div>
                        </div>
                        <div class="add-section">
                            <button class="btn btn-add" onclick="addOutputPair(${nodeIndex})">+</button>
                        </div>
                    </div>
                </div>
            `;
            
            nodesContainer.appendChild(newNodeConfig);

            // 切换到新节点
            switchToNode(nodeIndex);
        }        // 删除节点
        function removeNode(nodeIndex, event) {
            event.stopPropagation(); // 阻止事件冒泡
            
            // 第一个节点（索引为0）不允许删除
            if (nodeIndex === 0) {
                alert('第一个节点不能删除！');
                return;
            }
            
            // 如果只有一个节点，不允许删除
            const allTabs = document.querySelectorAll('.node-tab[data-node]');
            if (allTabs.length <= 1) {
                alert('至少需要保留一个节点！');
                return;
            }
            
            if (confirm('确定要删除这个节点吗？')) {
                // 删除标签
                const tab = document.querySelector(`[data-node="${nodeIndex}"]`);
                if (tab) tab.remove();
                
                // 删除配置
                const config = document.getElementById(`node-config-${nodeIndex}`);
                if (config) config.remove();
                
                // 如果删除的是当前激活的节点，切换到第一个节点
                if (currentNodeIndex === nodeIndex) {
                    switchToNode(0); // 总是切换到第一个节点
                }
            }
        }

        // 切换节点
        function switchToNode(nodeIndex) {
            // 更新标签状态
            document.querySelectorAll('.node-tab[data-node]').forEach(tab => {
                tab.classList.remove('active');
                if (parseInt(tab.getAttribute('data-node')) === nodeIndex) {
                    tab.classList.add('active');
                }
            });

            // 隐藏所有节点配置
            document.querySelectorAll('.single-node-config').forEach(config => {
                config.style.display = 'none';
            });

            // 显示当前节点配置
            const currentConfig = document.getElementById(`node-config-${nodeIndex}`);
            if (currentConfig) {
                currentConfig.style.display = 'block';
            }

            currentNodeIndex = nodeIndex;
        }

        // 更新节点标签显示
        function updateNodeTab(nodeIndex) {
            const nodeName = document.getElementById(`node-name-${nodeIndex}`).value.trim();
            const tab = document.querySelector(`[data-node="${nodeIndex}"] span`);
            if (tab) {
                tab.textContent = nodeName || `节点 ${nodeIndex + 1}`;
            }
        }

        // 分类翻译相关函数
        function addCategoryPair() {
            const container = document.getElementById('categories-pairs');
            if (container.querySelector('.empty-state')) {
                container.innerHTML = '';
            }
            const pair = createKeyValuePair('categories-pairs', 'removeCategoryPair');
            container.appendChild(pair);
        }

        function removeCategoryPair(btn) {
            const container = document.getElementById('categories-pairs');
            btn.parentElement.remove();
            if (container.children.length === 0) {
                container.innerHTML = '<div class="empty-state">点击下方 + 按钮添加分类翻译项</div>';
            }
        }        // 节点输入相关函数
        function addInputPair(nodeIndex = 0) {
            const container = document.getElementById(`inputs-pairs-${nodeIndex}`);
            if (container.querySelector('.empty-state')) {
                container.innerHTML = '';
            }
            const pair = createKeyValuePair(`inputs-pairs-${nodeIndex}`, 'removeInputPair');
            container.appendChild(pair);
        }

        function removeInputPair(btn) {
            const container = btn.parentElement.parentElement;
            btn.parentElement.remove();
            if (container.children.length === 0) {
                container.innerHTML = '<div class="empty-state">点击下方 + 按钮添加输入项</div>';
            }
        }

        // 节点控件相关函数
        function addWidgetPair(nodeIndex = 0) {
            const container = document.getElementById(`widgets-pairs-${nodeIndex}`);
            if (container.querySelector('.empty-state')) {
                container.innerHTML = '';
            }
            const pair = createKeyValuePair(`widgets-pairs-${nodeIndex}`, 'removeWidgetPair');
            container.appendChild(pair);
        }

        function removeWidgetPair(btn) {
            const container = btn.parentElement.parentElement;
            btn.parentElement.remove();
            if (container.children.length === 0) {
                container.innerHTML = '<div class="empty-state">点击下方 + 按钮添加控件项</div>';
            }
        }

        // 节点输出相关函数
        function addOutputPair(nodeIndex = 0) {
            const container = document.getElementById(`outputs-pairs-${nodeIndex}`);
            if (container.querySelector('.empty-state')) {
                container.innerHTML = '';
            }
            const pair = createKeyValuePair(`outputs-pairs-${nodeIndex}`, 'removeOutputPair');
            container.appendChild(pair);
        }

        function removeOutputPair(btn) {
            const container = btn.parentElement.parentElement;
            btn.parentElement.remove();
            if (container.children.length === 0) {
                container.innerHTML = '<div class="empty-state">点击下方 + 按钮添加输出项</div>';
            }
        }

        // 菜单翻译相关函数
        function addMenuPair() {
            const container = document.getElementById('menus-pairs');
            if (container.querySelector('.empty-state')) {
                container.innerHTML = '';
            }
            const pair = createKeyValuePair('menus-pairs', 'removeMenuPair');
            container.appendChild(pair);
        }

        function removeMenuPair(btn) {
            const container = document.getElementById('menus-pairs');
            btn.parentElement.remove();
            if (container.children.length === 0) {
                container.innerHTML = '<div class="empty-state">点击下方 + 按钮添加菜单翻译项</div>';
            }
        }

        // 获取键值对数据
        function getKeyValueData(containerId) {
            const container = document.getElementById(containerId);
            const pairs = container.querySelectorAll('.key-value-pair');
            const data = {};
            
            pairs.forEach(pair => {
                const inputs = pair.querySelectorAll('input');
                const key = inputs[0].value.trim();
                const value = inputs[1].value.trim();
                if (key && value) {
                    data[key] = value;
                }
            });
            
            return data;
        }        // 生成JSON
        function generateJSON() {
            if (!currentType) {
                alert('请先选择翻译类型！');
                return;
            }

            let jsonData = {};

            if (currentType === 'categories' || currentType === 'menus') {
                const pairsId = currentType + '-pairs';
                jsonData = getKeyValueData(pairsId);
            } else if (currentType === 'nodes') {
                // 获取所有存在的节点
                const nodeConfigs = document.querySelectorAll('.single-node-config');
                
                nodeConfigs.forEach(config => {
                    const nodeIndex = config.id.split('-')[2]; // 从 node-config-X 获取 X
                    const nodeNameElement = document.getElementById(`node-name-${nodeIndex}`);
                    
                    if (nodeNameElement) {
                        const nodeName = nodeNameElement.value.trim();                        if (nodeName) {
                            const nodeData = {};
                            
                            // 添加标题（必填）
                            const nodeTitle = document.getElementById(`node-title-${nodeIndex}`).value.trim();
                            if (!nodeTitle) {
                                alert(`节点 "${nodeName}" 的翻译标题不能为空！`);
                                return;
                            }
                            nodeData.title = nodeTitle;
                            
                            // 添加描述（如果有）
                            const nodeDesc = document.getElementById(`node-desc-${nodeIndex}`).value.trim();
                            if (nodeDesc) {
                                nodeData.description = nodeDesc;
                            }
                            
                            const inputs = getKeyValueData(`inputs-pairs-${nodeIndex}`);
                            const widgets = getKeyValueData(`widgets-pairs-${nodeIndex}`);
                            const outputs = getKeyValueData(`outputs-pairs-${nodeIndex}`);

                            if (Object.keys(inputs).length > 0) {
                                nodeData.inputs = inputs;
                            }
                            if (Object.keys(widgets).length > 0) {
                                nodeData.widgets = widgets;
                            }
                            if (Object.keys(outputs).length > 0) {
                                nodeData.outputs = outputs;
                            }

                            // 只有当节点有实际内容时才添加
                            if (Object.keys(nodeData).length > 0) {
                                jsonData[nodeName] = nodeData;
                            }
                        }
                    }
                });
            }

            if (Object.keys(jsonData).length === 0) {
                alert('请添加至少一个翻译项！');
                return;
            }

            // 显示预览
            const jsonString = JSON.stringify(jsonData, null, 4);
            const previewElement = document.getElementById('preview-content');
            const previewSection = document.getElementById('preview');
            
            console.log('JSON数据:', jsonData); // 调试信息
            console.log('JSON字符串:', jsonString); // 调试信息
            
            if (previewElement) {
                previewElement.textContent = jsonString;
                console.log('预览内容已设置'); // 调试信息
            } else {
                console.error('找不到预览元素'); // 调试信息
            }
            
            if (previewSection) {
                previewSection.classList.add('show');
                // 滚动到预览区域
                previewSection.scrollIntoView({ behavior: 'smooth' });
                console.log('预览区域已显示'); // 调试信息
            } else {
                console.error('找不到预览区域'); // 调试信息
            }

            // 下载文件
            downloadJSON(jsonData);
        }

        // 下载JSON文件
        function downloadJSON(data) {
            const filename = document.getElementById('filename').value.trim() || 'translation';
            const jsonString = JSON.stringify(data, null, 4);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = filename + '.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }        // 清空所有
        function clearAll() {
            if (confirm('确定要清空所有内容吗？')) {
                // 清空所有输入
                document.querySelectorAll('input').forEach(input => input.value = '');
                
                // 重置导入状态
                resetImportState();
                
                // 重置分类和菜单容器
                const simpleContainers = ['categories-pairs', 'menus-pairs'];
                simpleContainers.forEach(id => {
                    const container = document.getElementById(id);
                    if (container) {
                        let emptyText = '点击下方 + 按钮添加翻译项';
                        if (id.includes('categories')) emptyText = '点击下方 + 按钮添加分类翻译项';
                        else if (id.includes('menus')) emptyText = '点击下方 + 按钮添加菜单翻译项';
                        
                        container.innerHTML = `<div class="empty-state">${emptyText}</div>`;
                    }
                });
                
                // 重置节点相关
                if (currentType === 'nodes') {
                    // 重置为单个节点
                    nodeCount = 1;
                    currentNodeIndex = 0;
                      // 重置节点标签
                    const tabsContainer = document.querySelector('.node-tabs');
                    if (tabsContainer) {
                        tabsContainer.innerHTML = `
                            <button class="node-tab active" data-node="0" onclick="switchToNode(0)">
                                <span>节点 1</span>
                            </button>
                            <button class="btn btn-add-node" onclick="addNewNode()">+ 添加节点</button>
                        `;
                    }
                    
                    // 清理多余的节点配置
                    const nodesContainer = document.getElementById('nodes-container');
                    if (nodesContainer) {
                        nodesContainer.innerHTML = `
                            <div class="single-node-config" id="node-config-0" style="display: block;">
                                <div class="node-basic-info">
                                    <div class="node-name-input">
                                        <label for="node-name-0">🎯 节点类名 (Class Name):</label>
                                        <input type="text" id="node-name-0" placeholder="例如: KSampler" onchange="updateNodeTab(0)">
                                    </div>
                                    
                                    <div class="node-title-input">
                                        <label for="node-title-0">🏷️ 翻译后标题 (必填):</label>
                                        <input type="text" id="node-title-0" placeholder="例如: K采样器" required>
                                    </div>
                                    
                                    <div class="node-description-input">
                                        <label for="node-desc-0">📝 节点功能描述 (可选):</label>
                                        <input type="text" id="node-desc-0" placeholder="例如: 使用不同的采样器和调度器进行图像生成">
                                    </div>
                                </div>

                                <div class="node-sections">
                                    <div class="key-value-section">
                                        <div class="section-title">📥 输入 (Inputs)</div>
                                        <div id="inputs-pairs-0">
                                            <div class="empty-state">点击下方 + 按钮添加输入项</div>
                                        </div>
                                        <div class="add-section">
                                            <button class="btn btn-add" onclick="addInputPair(0)">+</button>
                                        </div>
                                    </div>

                                    <div class="key-value-section">
                                        <div class="section-title">🎛️ 控件 (Widgets)</div>
                                        <div id="widgets-pairs-0">
                                            <div class="empty-state">点击下方 + 按钮添加控件项</div>
                                        </div>
                                        <div class="add-section">
                                            <button class="btn btn-add" onclick="addWidgetPair(0)">+</button>
                                        </div>
                                    </div>

                                    <div class="key-value-section">
                                        <div class="section-title">📤 输出 (Outputs)</div>
                                        <div id="outputs-pairs-0">
                                            <div class="empty-state">点击下方 + 按钮添加输出项</div>
                                        </div>
                                        <div class="add-section">
                                            <button class="btn btn-add" onclick="addOutputPair(0)">+</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                }
                
                // 隐藏预览和贡献信息
                document.getElementById('preview').classList.remove('show');
                document.getElementById('contribute-info').classList.remove('show');
                
                // 重置类型选择
                document.querySelectorAll('.type-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.config-section').forEach(section => section.classList.remove('active'));
                currentType = '';
            }
        }// 贡献翻译
        function contributeTranslation() {
            if (!currentType) {
                alert('请先选择翻译类型！');
                return;
            }
            
            const contributeInfo = document.getElementById('contribute-info');
            if (contributeInfo.classList.contains('show')) {
                contributeInfo.classList.remove('show');
            } else {
                contributeInfo.classList.add('show');
                // 滚动到贡献信息区域
                contributeInfo.scrollIntoView({ behavior: 'smooth' });
            }
        }        // 创建GitHub Issue
        function createGitHubIssue() {
            if (!currentType) {
                alert('请先选择翻译类型并添加翻译内容！');
                return;
            }

            let issueTitle = '';
            let issueBody = '';
            const filename = document.getElementById('filename').value.trim() || 'translation';
            
            // 根据翻译类型生成不同的Issue标题和内容
            if (currentType === 'categories') {
                issueTitle = `[翻译贡献] 分类翻译 - ${filename}`;
                issueBody = `## 翻译类型\n📁 分类翻译 (Categories)\n\n## 文件名\n${filename}.json\n\n## 翻译内容描述\n请在此描述您翻译的分类内容...\n\n## 附件\n请将生成的 JSON 文件作为附件上传到此 Issue\n\n---\n*通过 ComfyUI 翻译生成器创建*`;
            } else if (currentType === 'nodes') {
                // 获取第一个节点名称作为示例
                const firstNodeName = document.getElementById('node-name-0').value.trim();
                issueTitle = `[翻译贡献] 节点翻译 - ${firstNodeName || filename}`;
                issueBody = `## 翻译类型\n🔧 节点翻译 (Nodes)\n\n## 节点名称\n${firstNodeName || '请填写节点类名'}\n\n## 文件名\n${filename}.json\n\n## 翻译内容描述\n请在此描述您翻译的节点功能和用途...\n\n## 附件\n请将生成的 JSON 文件作为附件上传到此 Issue\n\n---\n*通过 ComfyUI 翻译生成器创建*`;
            } else if (currentType === 'menus') {
                issueTitle = `[翻译贡献] 设置菜单翻译 - ${filename}`;
                issueBody = `## 翻译类型\n⚙️ 设置菜单翻译 (Menus)\n\n## 文件名\n${filename}.json\n\n## 翻译内容描述\n请在此描述您翻译的菜单或设置项...\n\n## 附件\n请将生成的 JSON 文件作为附件上传到此 Issue\n\n---\n*通过 ComfyUI 翻译生成器创建*`;
            }

            // 构建GitHub Issue URL
            const repoUrl = 'https://github.com/Dontdrunk/ComfyUI-DD-Translation';
            const issueUrl = `${repoUrl}/issues/new?title=${encodeURIComponent(issueTitle)}&body=${encodeURIComponent(issueBody)}&labels=翻译贡献`;
            
            // 打开GitHub Issue页面
            window.open(issueUrl, '_blank');
        }

        // JSON文件导入功能相关变量
        let importedJsonData = null;
        let importedFileName = '';

        // 触发文件选择
        function triggerFileInput() {
            document.getElementById('json-file-input').click();
        }

        // 监听文件选择
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('json-file-input');
            fileInput.addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (file) {
                    handleFileSelection(file);
                }
            });
        });

        // 处理文件选择
        function handleFileSelection(file) {
            if (file.type !== 'application/json' && !file.name.toLowerCase().endsWith('.json')) {
                alert('请选择有效的JSON文件！');
                return;
            }

            const fileInfo = document.getElementById('file-info');
            const importPreview = document.getElementById('import-preview');
            const importBtn = document.querySelector('.btn-import-process');

            // 更新文件信息显示
            fileInfo.textContent = file.name;
            fileInfo.classList.add('selected');
            importedFileName = file.name.replace('.json', '');

            // 读取文件内容
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const jsonContent = e.target.result;
                    importedJsonData = JSON.parse(jsonContent);
                    
                    // 显示预览
                    const previewContent = document.getElementById('import-preview-content');
                    previewContent.textContent = JSON.stringify(importedJsonData, null, 2);
                    importPreview.style.display = 'block';
                    
                    // 启用导入按钮
                    importBtn.disabled = false;
                    
                    // 自动设置文件名
                    const filenameInput = document.getElementById('filename');
                    if (!filenameInput.value.trim()) {
                        filenameInput.value = importedFileName;
                    }
                    
                } catch (error) {
                    alert('JSON文件格式错误，请检查文件内容！\n错误信息：' + error.message);
                    resetImportState();
                }
            };
            
            reader.onerror = function() {
                alert('文件读取失败，请重试！');
                resetImportState();
            };
            
            reader.readAsText(file);
        }

        // 重置导入状态
        function resetImportState() {
            importedJsonData = null;
            importedFileName = '';
            
            const fileInfo = document.getElementById('file-info');
            const importPreview = document.getElementById('import-preview');
            const importBtn = document.querySelector('.btn-import-process');
            const fileInput = document.getElementById('json-file-input');
            
            fileInfo.textContent = '未选择文件';
            fileInfo.classList.remove('selected');
            importPreview.style.display = 'none';
            importBtn.disabled = true;
            fileInput.value = '';
        }

        // 处理导入的文件
        function processImportedFile() {
            if (!importedJsonData) {
                alert('请先选择要导入的JSON文件！');
                return;
            }

            // 检测翻译类型
            const detectedType = detectTranslationType(importedJsonData);
            if (!detectedType) {
                alert('无法识别翻译文件的类型，请确保文件格式正确！');
                return;
            }

            // 自动选择相应的翻译类型
            selectTranslationType(detectedType);

            // 填充数据
            populateDataFromImport(detectedType, importedJsonData);

            // 显示成功提示
            alert(`✅ 成功导入${getTypeDisplayName(detectedType)}翻译文件！\n文件名：${importedFileName}.json\n您现在可以在此基础上进行编辑和补充。`);

            // 滚动到相应的配置区域
            const configSection = document.getElementById(detectedType + '-config');
            if (configSection) {
                configSection.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // 检测翻译类型
        function detectTranslationType(data) {
            // 检查是否为节点翻译
            for (const key in data) {
                const item = data[key];
                if (typeof item === 'object' && (item.title || item.inputs || item.widgets || item.outputs)) {
                    return 'nodes';
                }
            }
            
            // 检查是否为简单的键值对（分类或菜单）
            let hasSimpleValues = true;
            for (const key in data) {
                if (typeof data[key] !== 'string') {
                    hasSimpleValues = false;
                    break;
                }
            }
            
            if (hasSimpleValues) {
                // 根据文件名或内容推断类型
                if (importedFileName.toLowerCase().includes('categor') || 
                    importedFileName.toLowerCase().includes('分类')) {
                    return 'categories';
                } else {
                    return 'menus'; // 默认为菜单类型
                }
            }
            
            return null;
        }

        // 选择翻译类型
        function selectTranslationType(type) {
            // 移除所有活动状态
            document.querySelectorAll('.type-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.config-section').forEach(section => section.classList.remove('active'));
            
            // 设置当前类型
            currentType = type;
            const typeBtn = document.querySelector(`[data-type="${type}"]`);
            if (typeBtn) {
                typeBtn.classList.add('active');
            }
            
            const configSection = document.getElementById(type + '-config');
            if (configSection) {
                configSection.classList.add('active');
            }
        }

        // 填充导入的数据
        function populateDataFromImport(type, data) {
            if (type === 'categories') {
                populateCategoriesData(data);
            } else if (type === 'menus') {
                populateMenusData(data);
            } else if (type === 'nodes') {
                populateNodesData(data);
            }
        }

        // 填充分类数据
        function populateCategoriesData(data) {
            const container = document.getElementById('categories-pairs');
            container.innerHTML = '';
            
            Object.keys(data).forEach(key => {
                const pair = createKeyValuePair('categories-pairs', 'removeCategoryPair');
                const inputs = pair.querySelectorAll('input');
                inputs[0].value = key;
                inputs[1].value = data[key];
                container.appendChild(pair);
            });

            if (container.children.length === 0) {
                container.innerHTML = '<div class="empty-state">点击下方 + 按钮添加分类翻译项</div>';
            }
        }

        // 填充菜单数据
        function populateMenusData(data) {
            const container = document.getElementById('menus-pairs');
            container.innerHTML = '';
            
            Object.keys(data).forEach(key => {
                const pair = createKeyValuePair('menus-pairs', 'removeMenuPair');
                const inputs = pair.querySelectorAll('input');
                inputs[0].value = key;
                inputs[1].value = data[key];
                container.appendChild(pair);
            });

            if (container.children.length === 0) {
                container.innerHTML = '<div class="empty-state">点击下方 + 按钮添加菜单翻译项</div>';
            }
        }

        // 填充节点数据
        function populateNodesData(data) {
            // 清理现有节点
            clearExistingNodes();
            
            const nodeNames = Object.keys(data);
            let nodeIndex = 0;
            
            nodeNames.forEach((nodeName, index) => {
                const nodeData = data[nodeName];
                
                // 如果不是第一个节点，创建新节点
                if (index > 0) {
                    addNewNodeForImport(nodeIndex + 1);
                    nodeIndex++;
                }
                
                // 填充节点基本信息
                const nodeNameInput = document.getElementById(`node-name-${nodeIndex}`);
                const nodeTitleInput = document.getElementById(`node-title-${nodeIndex}`);
                const nodeDescInput = document.getElementById(`node-desc-${nodeIndex}`);
                
                if (nodeNameInput) nodeNameInput.value = nodeName;
                if (nodeTitleInput && nodeData.title) nodeTitleInput.value = nodeData.title;
                if (nodeDescInput && nodeData.description) nodeDescInput.value = nodeData.description;
                
                // 更新节点标签
                updateNodeTab(nodeIndex);
                
                // 填充输入、控件、输出数据
                if (nodeData.inputs) {
                    populateKeyValueSection(`inputs-pairs-${nodeIndex}`, nodeData.inputs, 'removeInputPair');
                }
                if (nodeData.widgets) {
                    populateKeyValueSection(`widgets-pairs-${nodeIndex}`, nodeData.widgets, 'removeWidgetPair');
                }
                if (nodeData.outputs) {
                    populateKeyValueSection(`outputs-pairs-${nodeIndex}`, nodeData.outputs, 'removeOutputPair');
                }
                
                nodeIndex++;
            });
            
            // 更新全局变量
            nodeCount = nodeIndex;
            
            // 切换到第一个节点
            switchToNode(0);
        }

        // 为导入创建新节点（不触发默认事件）
        function addNewNodeForImport(nodeIndex) {
            // 添加节点标签
            const tabsContainer = document.querySelector('.node-tabs');
            const addButton = tabsContainer.querySelector('.btn-add-node');
            
            const newTab = document.createElement('button');
            newTab.className = 'node-tab';
            newTab.setAttribute('data-node', nodeIndex);
            newTab.onclick = () => switchToNode(nodeIndex);
            newTab.innerHTML = `
                <span>节点 ${nodeIndex + 1}</span>
                <button class="tab-close" onclick="removeNode(${nodeIndex}, event)">×</button>
            `;
            
            tabsContainer.insertBefore(newTab, addButton);

            // 创建新的节点配置
            const nodesContainer = document.getElementById('nodes-container');
            const newNodeConfig = document.createElement('div');
            newNodeConfig.className = 'single-node-config';
            newNodeConfig.id = `node-config-${nodeIndex}`;
            newNodeConfig.innerHTML = `
                <div class="node-basic-info">
                    <div class="node-name-input">
                        <label for="node-name-${nodeIndex}">🎯 节点类名 (Class Name):</label>
                        <input type="text" id="node-name-${nodeIndex}" placeholder="例如: KSampler" onchange="updateNodeTab(${nodeIndex})">
                    </div>
                    
                    <div class="node-title-input">
                        <label for="node-title-${nodeIndex}">🏷️ 翻译后标题 (必填):</label>
                        <input type="text" id="node-title-${nodeIndex}" placeholder="例如: K采样器" required>
                    </div>
                    
                    <div class="node-description-input">
                        <label for="node-desc-${nodeIndex}">📝 节点功能描述 (可选):</label>
                        <input type="text" id="node-desc-${nodeIndex}" placeholder="例如: 使用不同的采样器和调度器进行图像生成">
                    </div>
                </div>

                <div class="node-sections">
                    <!-- 输入项 -->
                    <div class="key-value-section">
                        <div class="section-title">📥 输入 (Inputs)</div>
                        <div id="inputs-pairs-${nodeIndex}">
                            <div class="empty-state">点击下方 + 按钮添加输入项</div>
                        </div>
                        <div class="add-section">
                            <button class="btn btn-add" onclick="addInputPair(${nodeIndex})">+</button>
                        </div>
                    </div>

                    <!-- 控件项 -->
                    <div class="key-value-section">
                        <div class="section-title">🎛️ 控件 (Widgets)</div>
                        <div id="widgets-pairs-${nodeIndex}">
                            <div class="empty-state">点击下方 + 按钮添加控件项</div>
                        </div>
                        <div class="add-section">
                            <button class="btn btn-add" onclick="addWidgetPair(${nodeIndex})">+</button>
                        </div>
                    </div>

                    <!-- 输出项 -->
                    <div class="key-value-section">
                        <div class="section-title">📤 输出 (Outputs)</div>
                        <div id="outputs-pairs-${nodeIndex}">
                            <div class="empty-state">点击下方 + 按钮添加输出项</div>
                        </div>
                        <div class="add-section">
                            <button class="btn btn-add" onclick="addOutputPair(${nodeIndex})">+</button>
                        </div>
                    </div>
                </div>
            `;
            
            nodesContainer.appendChild(newNodeConfig);
        }

        // 清理现有节点
        function clearExistingNodes() {
            // 重置节点计数和当前索引
            nodeCount = 1;
            currentNodeIndex = 0;
            
            // 清理节点标签（保留第一个）
            const tabsContainer = document.querySelector('.node-tabs');
            const allTabs = tabsContainer.querySelectorAll('.node-tab[data-node]');
            allTabs.forEach((tab, index) => {
                if (index > 0) { // 保留第一个节点
                    tab.remove();
                }
            });
            
            // 清理节点配置（保留第一个）
            const nodesContainer = document.getElementById('nodes-container');
            const allConfigs = nodesContainer.querySelectorAll('.single-node-config');
            allConfigs.forEach((config, index) => {
                if (index > 0) { // 保留第一个节点
                    config.remove();
                }
            });
            
            // 清空第一个节点的内容
            const firstNodeIndex = 0;
            document.getElementById(`node-name-${firstNodeIndex}`).value = '';
            document.getElementById(`node-title-${firstNodeIndex}`).value = '';
            document.getElementById(`node-desc-${firstNodeIndex}`).value = '';
            
            // 清空第一个节点的键值对
            clearKeyValueSection(`inputs-pairs-${firstNodeIndex}`, '点击下方 + 按钮添加输入项');
            clearKeyValueSection(`widgets-pairs-${firstNodeIndex}`, '点击下方 + 按钮添加控件项');
            clearKeyValueSection(`outputs-pairs-${firstNodeIndex}`, '点击下方 + 按钮添加输出项');
            
            // 重置第一个节点标签
            const firstTab = document.querySelector('[data-node="0"] span');
            if (firstTab) {
                firstTab.textContent = '节点 1';
            }
        }

        // 填充键值对区域
        function populateKeyValueSection(containerId, data, removeFunction) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            Object.keys(data).forEach(key => {
                const pair = createKeyValuePair(containerId, removeFunction);
                const inputs = pair.querySelectorAll('input');
                inputs[0].value = key;
                inputs[1].value = data[key];
                container.appendChild(pair);
            });
        }

        // 清空键值对区域
        function clearKeyValueSection(containerId, emptyText) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="empty-state">${emptyText}</div>`;
        }

        // 获取类型显示名称
        function getTypeDisplayName(type) {
            const names = {
                'categories': '分类',
                'nodes': '节点',
                'menus': '设置菜单'
            };
            return names[type] || type;
        }
    </script>
</body>
</html>
